<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Finding clusters of groups with invariant measurement • MIE</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Finding clusters of groups with invariant measurement">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MIE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6-02</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Vignette1.html">Finding clusters of groups with invariant measurement</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Finding clusters of groups with invariant measurement</h1>
            
            <h4 data-toc-skip class="date">2025-11-15</h4>
      

      <div class="d-none name"><code>Vignette1.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://maksimrudnev.github.io/MIE.package/">MIE</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/reshape" class="external-link">reshape2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lavaan.ugent.be" class="external-link">lavaan</a></span><span class="op">)</span></span></code></pre></div>
<p>Comparing psychological constructs, attitudes, or behaviors across
groups is one of the most common goals in social and behavioral
research. We often want to know whether a latent factor, such as
well-being or math anxiety, has the same meaning across populations,
cultures, or time points. Before comparing latent means or structural
paths, we must ensure that the construct is measured in the same way
across groups.</p>
<p>Let’s say you have been developing a measurement scale and at some
point you have tested measurement invariance, and the test has failed.
You suspect that some groups are non-invariant, but you don’t know which
ones. Moreover, if you have many groups, manually testing all pairwise
combinations is not feasible. One of a few solutions is to use the
multiple groups alignment (or more generally penalized SEM), but it may
not be available for your model or software. More flexible solution is
to use the Measurement Invariance Explorer (MIE) application, which
allows you to explore which groups are similar in terms of measurement
model parameters (or even more observed covariances/correlations).</p>
<p>If a factor loading or intercept differs from one group to another,
the scale or the origin of the latent variable changes. Observed
differences may then reflect differences in how the construct is
measured, rather than true differences in the construct itself.</p>
<p>Traditionally, researchers test measurement invariance through a
sequence of multiple-group confirmatory factor analysis (MGCFA) models
that impose increasing constraints: the configural model (same
structure), the metric model (equal loadings), and the scalar model
(equal loadings and intercepts). When fit indices remain stable across
these steps, invariance is supported.</p>
<p>However, this approach becomes cumbersome when the number of groups
increases, as in large cross-national surveys or longitudinal studies
with many waves. Even alignment methods (Muthén &amp; Asparouhov, 2013,
2014), which optimize parameters to minimize non-invariance, assume that
most parameters are invariant — an assumption that may not always
hold.</p>
<p>The Measurement Invariance Explorer (MIE) package provides a new
perspective. Instead of strict hypothesis testing, it offers an
exploratory and visual framework that helps users detect patterns of
similarity and dissimilarity among groups. It complements confirmatory
analysis by revealing which groups are similar, which ones differ, and
how large those differences are.</p>
<div class="section level2">
<h2 id="example---clusters-of-groups">Example - clusters of groups<a class="anchor" aria-label="anchor" href="#example---clusters-of-groups"></a>
</h2>
<p>To illustrate the idea, we will use simulated data emulating a short
scale of political efficacy. It has two factors with four items
each:</p>
<pre><code><span><span class="va">F1</span> <span class="op">=</span><span class="op">~</span> <span class="va">v1</span>  <span class="op">+</span> <span class="va">v2</span>  <span class="op">+</span> <span class="va">v3</span>  <span class="op">+</span> <span class="va">v4</span>;</span>
<span><span class="va">F2</span> <span class="op">=</span><span class="op">~</span> <span class="va">v11</span> <span class="op">+</span> <span class="va">v12</span> <span class="op">+</span> <span class="va">v13</span> <span class="op">+</span> <span class="va">v14</span>;</span></code></pre>
<p>We have 20 countries (with 500 observations in each) and there are 4
regions of countries (East Asia, Western Europe, Eastern Europe, and
Latin America), each with different factor loadings. Within each region,
countries have similar measurement parameters, but these parameters
differ across regions, so true factor loadings are:</p>
<pre><code><span><span class="co">##   Parameter Western_Europe Eastern_Europe Latin_America East_Asia</span></span>
<span><span class="co">## 1  F1 by v1              1            1.0           1.0       1.0</span></span>
<span><span class="co">## 2  F1 by v2              1            0.4           0.4       0.4</span></span>
<span><span class="co">## 3  F1 by v3              1            0.3           0.7       0.1</span></span>
<span><span class="co">## 4  F1 by v4              1            0.2           0.7       1.0</span></span>
<span><span class="co">## 5 F2 by v11              1            1.0           1.0       1.0</span></span>
<span><span class="co">## 6 F2 by v12              1            0.4           0.4       0.4</span></span>
<span><span class="co">## 7 F2 by v13              1            0.3           0.7       0.1</span></span>
<span><span class="co">## 8 F2 by v14              1            0.2           0.7       1.0</span></span></code></pre>
<p>The issue is that we don’t know in advance, that these 4 regions
exist, and which countries belong to which region. We only know that we
have 20 countries.</p>
<p>Conventional tests of invariance would show that there is no metric
invariance, as expected. <code>MIE</code> has a convenient function for
this:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">global_mi_test</span> <span class="op">=</span> <span class="fu"><a href="../reference/globalMI.html">globalMI</a></span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="st">'F1 =~ v1  + v2  + v3  + v4;</span></span>
<span><span class="st">           F2 =~ v11 + v12 + v13 + v14;'</span>,  </span>
<span>  group <span class="op">=</span> <span class="st">"group"</span>, </span>
<span>  data <span class="op">=</span> <span class="va">sim_data</span>,</span>
<span>  what <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cfi"</span>, <span class="st">"rmsea"</span>, <span class="st">"srmr"</span><span class="op">)</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">T</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">global_mi_test</span><span class="op">$</span><span class="va">fit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##              cfi diff.cfi rmsea diff.rmsea  srmr diff.srmr</span></span>
<span><span class="co">## configural 1.000       NA 0.000         NA 0.023        NA</span></span>
<span><span class="co">## metric     0.854   -0.146 0.082      0.082 0.076     0.053</span></span>
<span><span class="co">## scalar     0.852   -0.002 0.075     -0.008 0.077     0.002</span></span></code></pre>
<p>Comparing CFI and RMSEA across models shows that metric invariance is
not supported. What should we do next? Some of our options are:</p>
<ol style="list-style-type: decimal">
<li>find a subset of parameters which is invariant across all
groups;</li>
</ol>
<ol style="list-style-type: lower-alpha">
<li>partial invariance (relax some constraints, but not less than two
per each factor - Byrne, Shavelson, &amp; Muthen, 1989);</li>
<li>approximate invariance (relax strict equality of parameters,
Bayesian zero priors on differences);</li>
</ol>
<ol start="2" style="list-style-type: decimal">
<li>find a subset of groups:</li>
</ol>
<ol style="list-style-type: lower-alpha">
<li>alignment method (Muthen &amp; Asparouhov, 2013, 2014a, 2014b),
minimizing non-invariance by finding convenient factor means and
variances (available only in Mplus), however: <em>“The assumption of the
alignment method is that a majority of the parameters are invariant and
a minority of the parameters are non-invariant.” (Muthen &amp;
Asparouhov, 2013)</em>; the new PSEM approach may help overcome this
limitation but a lot is unknown yet.</li>
<li>repeatedly re-run MGCFA model with different subsets of groups -
this is the approach that is made easy in MIE.</li>
</ol>
<p>All these methods could be useful, but they all have limitations.
Partial invariance may not be feasible if too many parameters are
non-invariant, approximate invariance requires Bayesian estimation which
may not be available for your model or software, and alignment assumes
that most parameters are invariant.</p>
<p>So let’s try stratified invarince methodology.</p>
<div class="section level3">
<h3 id="finding-clusters-of-groups-with-mie">Finding clusters of groups with MIE<a class="anchor" aria-label="anchor" href="#finding-clusters-of-groups-with-mie"></a>
</h3>
<p>The Measurement Invariance Explorer (MIE) package provides a new
perspective. Instead of strict hypothesis testing, it offers an
exploratory and visual framework that helps users detect patterns of
similarity and dissimilarity among groups. It complements confirmatory
analyses by revealing which groups are similar, which ones differ, and
how large those differences are. The general idea is to compute some
measure of “invariance distance” between each pair of groups, and then
use multidimensional scaling (MDS) to visualize these distances in two
dimensions and/or clusterize groups. Groups that are close together in
the plot are more similar in terms of measurement parameters, while
those that are far apart are more dissimilar.</p>
<p>MIE provides many measures of “invariance distance” which can be
split into three categories: no measurement model implied (very crude
measures based on correlations and covariances), when measurement model
implied and we focus on measurement parameters (loadings and
intercepts), and based on changes in fit indices of pairwise models.
Below is a brief overview of these measures.</p>
<div class="section level4">
<h4 id="no-measurement-model-implied">No measurement model implied<a class="anchor" aria-label="anchor" href="#no-measurement-model-implied"></a>
</h4>
<ul>
<li>
<strong>Covariances (no model implied)</strong> Commonly used
multidimensional scaling (MDS) of all available indicators. Two
dimensions are extracted.</li>
<li>
<strong>Correlations (no model implied)</strong> After applying
Fisher’s z transformation, the distances are computed, sent to MDS and
plotted. If the model fits data well, correlations/covariances and model
parameters should differ across groups in a similar way.</li>
</ul>
</div>
<div class="section level4">
<h4 id="parameters-in-a-global-model">Parameters in a global model<a class="anchor" aria-label="anchor" href="#parameters-in-a-global-model"></a>
</h4>
<ul>
<li><p><strong>Parameters: loadings (configural MGCFA)</strong> A single
multiple group confirmatory factor analysis with non-constrained factor
loadings and intercepts. It extracts loadings, and uses them to compute
distance matrix, which is then scaled and plotted.</p></li>
<li><p><strong>Parameters: intercepts (metric MGCFA)</strong> Analogous
to previous one, but loadings are constrained and free intercepts are
used as a measure of distance between groups.</p></li>
</ul>
</div>
<div class="section level4">
<h4 id="change-in-fit-indices-of-pairwise-models">Change in fit indices of pairwise models<a class="anchor" aria-label="anchor" href="#change-in-fit-indices-of-pairwise-models"></a>
</h4>
<ul>
<li>
<strong>Change in fit indices from configural to metric
model</strong>
<ol style="list-style-type: decimal">
<li>Configural and metric MGCFA models are fitted to subsamples of every
possible pair of groups.</li>
<li>Global fit indices are extracted and their change between the two
models is computed, they reflect “invariance distances” between each
pair of groups.</li>
<li>Without further transformations, CFI, RMSEA, or SRMR for each pair
of groups are used to compute two-dimensional scaling and plot the group
points.</li>
</ol>
</li>
<li>
<strong>Change in fit indices from metric to scalar model</strong>
Analogous to previous one, only metric and scalar models are fitted to
the pairs of groups.</li>
</ul>
<p>All these measures have their pro and cons For example, change in fit
indices can be problematic because CFA, RMSEA, and SRMR, as well as
their increments do not have known distributions, while calculation of
distance assumes normality. Nevertheless, they all may be useful in
practice, depending on the data and the research question.</p>
<p>NB. There is also very promising approach called dMACs but it’s not
implemented in MIE yet.</p>
<p>Let’s see how MIE works with our simulated data. We need to pick the
measure, calculate it, and plot the results. First we will use
correlations, next loadings, and finally CFI as measures of distance
between groups.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">corrs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getMetrics.html">getMetrics</a></span><span class="op">(</span></span>
<span>  group <span class="op">=</span> <span class="st">"group"</span>, </span>
<span>  data <span class="op">=</span> <span class="va">sim_data</span>, </span>
<span>  metric <span class="op">=</span> <span class="st">"correlation"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plotDistances.html">plotDistances</a></span><span class="op">(</span><span class="va">corrs</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Optimal number of clusters is  4</span></span></code></pre>
<p><img src="Vignette1_files/figure-html/mie_correlation-1.png" width="700"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all_loadings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getMetrics.html">getMetrics</a></span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="st">'F1 =~ v1  + v2  + v3  + v4;</span></span>
<span><span class="st">           F2 =~ v11 + v12 + v13 + v14;'</span>,</span>
<span>  group <span class="op">=</span> <span class="st">"group"</span>, </span>
<span>  data <span class="op">=</span> <span class="va">sim_data</span>, </span>
<span>  metric <span class="op">=</span> <span class="st">"parameters"</span>,</span>
<span>  parameters <span class="op">=</span> <span class="st">"loadings"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plotDistances.html">plotDistances</a></span><span class="op">(</span><span class="va">all_loadings</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Optimal number of clusters is  4</span></span></code></pre>
<p><img src="Vignette1_files/figure-html/mie_loadings-1.png" width="700"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CFIs</span> <span class="op">=</span> <span class="fu"><a href="../reference/getMetrics.html">getMetrics</a></span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="st">'F1 =~ v1  + v2  + v3  + v4;</span></span>
<span><span class="st">           F2 =~ v11 + v12 + v13 + v14;'</span>,  </span>
<span>  group <span class="op">=</span> <span class="st">"group"</span>, </span>
<span>  data <span class="op">=</span> <span class="va">sim_data</span>,</span>
<span>  metric <span class="op">=</span> <span class="st">"fit"</span>,</span>
<span>  level <span class="op">=</span> <span class="st">"metric"</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">T</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plotDistances.html">plotDistances</a></span><span class="op">(</span><span class="va">CFIs</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Optimal number of clusters is  5</span></span></code></pre>
<p><img src="Vignette1_files/figure-html/mie_cfi-1.png" width="700"></p>
<p>Alternatively, we may use a cutoff value rather than a continuous
distance to form clusters and show on the plot. For CFI, a cutoff of
0.01 is often used in invariance testing (e.g., following Chen,
2007).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotDistances.html">plotDistances</a></span><span class="op">(</span><span class="va">CFIs</span>, cutoff <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span></code></pre></div>
<p><img src="Vignette1_files/figure-html/mie_clusters-1.png" width="700"></p>
<p>Overall, all three measures have managed to recover the true clusters
of groups quite well. Correlations and loadings did a perfect job, while
CFI made a minor mistake (group Eastern_Europe_G4 was misplaced).</p>
<p>Now, that we found clusters of similar groups, we can run a
stratified MGCFA models on these clusters to test for invariance within
each cluster. There is a convenience function for this too:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># first, let's get the strata based on CFI distances</span></span>
<span><span class="va">distance_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plotDistances.html">plotDistances</a></span><span class="op">(</span><span class="va">CFIs</span>, cutoff <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># You can automate getting clusters, for example, like this, </span></span>
<span><span class="co"># but it's recommended to visually inspect the plot and define clusters manually.</span></span>
<span><span class="co"># lapply(setNames(nm=unique(distance_plot$data$cluster)), function(x) {</span></span>
<span><span class="co">#    distance_plot$data$group[distance_plot$data$cluster == x]</span></span>
<span><span class="co"># })</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="../reference/stratifiedMI.html">stratifiedMI</a></span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="st">'F1 =~ v1  + v2  + v3  + v4;</span></span>
<span><span class="st">           F2 =~ v11 + v12 + v13 + v14;'</span>,  </span>
<span>  group <span class="op">=</span> <span class="st">"group"</span>, </span>
<span>  data <span class="op">=</span> <span class="va">sim_data</span>, </span>
<span>  strata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"East_Asia"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"East_Asia_G1"</span>, <span class="st">"East_Asia_G2"</span>, <span class="st">"East_Asia_G3"</span>, <span class="st">"East_Asia_G4"</span>, <span class="st">"East_Asia_G5"</span><span class="op">)</span>, </span>
<span>                <span class="st">"Eastern_Europe"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Eastern_Europe_G1"</span>, <span class="st">"Eastern_Europe_G2"</span>, <span class="st">"Eastern_Europe_G3"</span>, <span class="st">"Eastern_Europe_G4"</span>, <span class="st">"Eastern_Europe_G5"</span><span class="op">)</span>, </span>
<span>                <span class="st">"Latin_America"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Latin_America_G1"</span>, <span class="st">"Latin_America_G2"</span>, <span class="st">"Latin_America_G3"</span>, <span class="st">"Latin_America_G4"</span>, <span class="st">"Latin_America_G5"</span><span class="op">)</span>, </span>
<span>                <span class="st">"Western_Europe"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Western_Europe_G1"</span>, <span class="st">"Western_Europe_G2"</span>, <span class="st">"Western_Europe_G3"</span>, <span class="st">"Western_Europe_G4"</span>, <span class="st">"Western_Europe_G5"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##                     cfi tli rmsea  srmr    bic  df cfi    tli rmsea  srmr   bic</span></span>
<span><span class="co">## fits[[ref]]           1   1 0.000 0.023 254337 380                             </span></span>
<span><span class="co">## fits[["clustered"]]   1   1 0.003 0.035 252526 604   0 -0.003 0.003 0.012 -1811</span></span>
<span><span class="co">##                      df</span></span>
<span><span class="co">## fits[[ref]]            </span></span>
<span><span class="co">## fits[["clustered"]] 224</span></span></code></pre>
<p>The results show that within each cluster, metric invariance holds
very well (CFI remains high and stable, RMSEA and SRMR are low while df
is drastically different). This confirms that the clusters identified by
MIE are meaningful in terms of measurement invariance.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="comparison-with-other-approaches">Comparison with other approaches<a class="anchor" aria-label="anchor" href="#comparison-with-other-approaches"></a>
</h2>
<p>Let’s go quickly through some other options available with the same
dataset.</p>
<div class="section level3">
<h3 id="partial-invariance">1. Partial invariance<a class="anchor" aria-label="anchor" href="#partial-invariance"></a>
</h3>
<p>Before we can fit the partial metric model we need to identify what
parameters are non-invariant.</p>
<p>Let’s use the metric model already fitted in the previous step and
run a score test. It is available in <code>lavaan</code> through
<code>lavTestScore</code> function, but its output is not very
user-friendly. <code>MIE</code> provides a wrapper version of the output
through <code>lavTestScore_clean</code> function. (Note, both take a
substantial time to compute, ~1-2min in this case).</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">score_test</span> <span class="op">=</span> <span class="fu"><a href="../reference/lavTestScore_clean.html">lavTestScore_clean</a></span><span class="op">(</span><span class="va">global_mi_test</span><span class="op">$</span><span class="va">models</span><span class="op">$</span><span class="va">metric</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">score_test</span><span class="op">$</span><span class="va">uni</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Chi-square test of releasing single constraints, equivalent to modification indices</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##      Term       Group1       Group2 Chi.square df p.value   .</span></span>
<span><span class="co">## 1  F1=~v2 East_Asia_G1 East_Asia_G5      0.981  1   0.322    </span></span>
<span><span class="co">## 2  F1=~v3 East_Asia_G1 East_Asia_G5     91.762  1   0.000 ***</span></span>
<span><span class="co">## 3  F1=~v4 East_Asia_G1 East_Asia_G5     20.226  1   0.000 ***</span></span>
<span><span class="co">## 4 F2=~v12 East_Asia_G1 East_Asia_G5      4.100  1   0.043 *  </span></span>
<span><span class="co">## 5 F2=~v13 East_Asia_G1 East_Asia_G5     42.148  1   0.000 ***</span></span>
<span><span class="co">## 6 F2=~v14 East_Asia_G1 East_Asia_G5     15.037  1   0.000 ***</span></span></code></pre>
<p>The table is very long and it is tedious to look through all of it.
To get a quick overview of which parameters are most non-invariant
across groups, we can aggregate the score test statistics by group:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">score_test</span><span class="op">$</span><span class="va">uni</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Term</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>Chi.square.sum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Chi.square</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">Chi.square.sum</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 2</span></span></span>
<span><span class="co">##   Term    Chi.square.sum</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> F1=~v3            470.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> F2=~v13           318.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> F1=~v4            251.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> F2=~v14           217.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> F1=~v2            174.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> F2=~v12           145.</span></span></code></pre>
<p>Now we have to rerun the model with partial invariance, freeing the
most non-invariant parameters. Let’s free loadings of v3, v13, v4, and
v12 – these were the groups with the highest score test statistics for
these parameters and it’s the maximum number of free loadings we could
afford in a partial invariance model (recall that partial metric
invariance requires at least two invariant loadings).</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">global_mi_test2</span> <span class="op">=</span> <span class="fu"><a href="../reference/globalMI.html">globalMI</a></span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="st">'F1 =~ v1  + v2  + v3  + v4;</span></span>
<span><span class="st">           F2 =~ v11 + v12 + v13 + v14;'</span>,  </span>
<span>  group <span class="op">=</span> <span class="st">"group"</span>, </span>
<span>  data <span class="op">=</span> <span class="va">sim_data</span>,</span>
<span>  partial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"F1=~v3"</span>, <span class="st">"F2=~v13"</span>, <span class="st">"F1=~v4"</span>, <span class="st">"F2=~v12"</span><span class="op">)</span>,</span>
<span>  omit <span class="op">=</span> <span class="st">'scalar'</span>,</span>
<span>  what <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cfi"</span>, <span class="st">"rmsea"</span>, <span class="st">"srmr"</span><span class="op">)</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">T</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">global_mi_test2</span><span class="op">$</span><span class="va">fit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                  cfi diff.cfi rmsea diff.rmsea  srmr diff.srmr</span></span>
<span><span class="co">## configural     1.000       NA 0.000         NA 0.023        NA</span></span>
<span><span class="co">## metric         0.854   -0.146 0.082      0.082 0.076     0.053</span></span>
<span><span class="co">## partial.metric 0.961    0.107 0.046     -0.036 0.046    -0.030</span></span></code></pre>
<p>The fit has improved, but still not enough to claim metric
invariance. Moreover, we had to make a lot of decisions along the way
(which parameters to free, how many of them, etc), which makes the
process subjective and not very reproducible. Overall, this approach
doesn’t work here because (we know it) all the loadings are
non-invariant, wo relaxing constraints on some of them won’t help.</p>
<p>So maybe alignment could help?</p>
</div>
<div class="section level3">
<h3 id="alignment-method">2. Alignment method<a class="anchor" aria-label="anchor" href="#alignment-method"></a>
</h3>
<p>The alignment method is available in Mplus, and it’s getting more and
more flexible. The idea is to find factor loadings and intercepts that
minimize non-invariance across groups. However, as mentioned before, it
assumes that most parameters are invariant, which is not the case here.
Still, let’s see what happens. Running alignment may involve multiple
steps (see an <a href="https://maksimrudnev.com/2019/05/01/alignment-tutorial/" class="external-link">in-depth
alignment tutorial</a>), but <code>MIE</code> automates its typical
steps.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">align_res</span> <span class="op">=</span> <span class="fu"><a href="../reference/runAlignment.html">runAlignment</a></span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="st">'F1 BY v1 v2 v3 v4;</span></span>
<span><span class="st">           F2 BY v11 v12 v13 v14;'</span>,  </span>
<span>  group <span class="op">=</span> <span class="st">"group"</span>, </span>
<span>  dat <span class="op">=</span> <span class="va">sim_data</span>,</span>
<span>  Mplus_com <span class="op">=</span> <span class="st">"/Applications/Mplus/mplus"</span>,</span>
<span>  sim.samples <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  summaries <span class="op">=</span> <span class="cn">T</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">align_res</span><span class="op">$</span><span class="va">fixed</span><span class="op">$</span><span class="va">summary</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Loadings"</span>, <span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                     N_invariant N_noninvariant</span></span>
<span><span class="co">## Loadings  F1 by V1           18              2</span></span>
<span><span class="co">## Loadings  F1 by V2           19              1</span></span>
<span><span class="co">## Loadings  F1 by V3           14              6</span></span>
<span><span class="co">## Loadings  F1 by V4           15              5</span></span>
<span><span class="co">## Loadings  F2 by V11          20              0</span></span>
<span><span class="co">## Loadings  F2 by V12          20              0</span></span>
<span><span class="co">## Loadings  F2 by V13          11              9</span></span>
<span><span class="co">## Loadings  F2 by V14          15              5</span></span>
<span><span class="co">##                                                           invariant.gr</span></span>
<span><span class="co">## Loadings  F1 by V1        1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 17 18 19</span></span>
<span><span class="co">## Loadings  F1 by V2     1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 17 18 19 20</span></span>
<span><span class="co">## Loadings  F1 by V3              6 7 8 10 11 12 13 14 15 16 17 18 19 20</span></span>
<span><span class="co">## Loadings  F1 by V4             1 2 3 4 5 11 12 13 14 15 16 17 18 19 20</span></span>
<span><span class="co">## Loadings  F2 by V11 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20</span></span>
<span><span class="co">## Loadings  F2 by V12 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20</span></span>
<span><span class="co">## Loadings  F2 by V13                   10 11 12 13 14 15 16 17 18 19 20</span></span>
<span><span class="co">## Loadings  F2 by V14            1 2 3 4 5 11 12 13 14 15 16 17 18 19 20</span></span>
<span><span class="co">##                          non.invar.gr</span></span>
<span><span class="co">## Loadings  F1 by V1              16 20</span></span>
<span><span class="co">## Loadings  F1 by V2                 16</span></span>
<span><span class="co">## Loadings  F1 by V3        2 3 4 5 9 1</span></span>
<span><span class="co">## Loadings  F1 by V4         6 7 8 9 10</span></span>
<span><span class="co">## Loadings  F2 by V11                  </span></span>
<span><span class="co">## Loadings  F2 by V12                  </span></span>
<span><span class="co">## Loadings  F2 by V13 2 3 4 5 6 7 8 9 1</span></span>
<span><span class="co">## Loadings  F2 by V14        6 7 8 9 10</span></span></code></pre>
<p>As we can see, the alignment has not managed to identify groups with
non-invariant loadings very well. It approached a part of the true
pattern, for example, for loading on V4 and V14 it indicated groups 6-10
which is indeed the largest outlier in terms of its loadings, but the
remaining patterns are blurred. This is expected, given that the
assumption of most parameters being invariant is violated.</p>
<p>To sum up, MIE provides a flexible and visual framework to explore
measurement invariance across many groups. It can help identify clusters
of similar groups when traditional methods struggle. However, it is
exploratory in nature and should be complemented with confirmatory
analyses.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Maksim Rudnev.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
